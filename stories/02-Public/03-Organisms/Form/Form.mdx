import { Meta, Canvas, Controls } from '@storybook/addon-docs/blocks'
import * as FormStories from './Form.stories'

<Meta of={FormStories} />

# Form

Sistema completo de formulários com **React Hook Form** e **Zod**. Validação
automática, mensagens de erro integradas e acessibilidade total incluída por
padrão.

## Quando Usar

✅ **Para TODOS os formulários** - Sistema completo e validado ✅ **Para
validação complexa** - Regras Zod integradas ✅ **Para formulários
multi-step** - Com controle de estado ✅ **Para forms com dependências** -
Campos que dependem de outros

## Quando NÃO Usar

❌ **Para inputs simples isolados** - Use Input diretamente ❌ **Para
formulários sem validação** - Considere se realmente não precisa

---

## Subcomponentes

O sistema Form é composto por 7 subcomponentes:

- **Form** - Provider do React Hook Form
- **FormField** - Controller para cada campo
- **FormItem** - Container do campo
- **FormLabel** - Label automática com validação
- **FormControl** - Wrapper do input com ARIA
- **FormDescription** - Texto de ajuda
- **FormMessage** - Mensagens de erro automáticas

---

## Exemplos

### Login Form

<Canvas of={FormStories.LoginForm} />

### Contact Form

<Canvas of={FormStories.ContactForm} />

### Form com Checkbox

<Canvas of={FormStories.FormWithCheckbox} />

### Form com Validação Completa

<Canvas of={FormStories.ValidationForm} />

### Registration Form Completo

<Canvas of={FormStories.RegistrationForm} />

---

## Playground

<Canvas of={FormStories.Playground} />
<Controls of={FormStories.Playground} />

---

## Acessibilidade

- ✅ **ARIA automático** - `aria-invalid`, `aria-describedby` automáticos
- ✅ **Labels associados** - `htmlFor` e `id` gerenciados automaticamente
- ✅ **Mensagens de erro** - Anunciadas para leitores de tela
- ✅ **Focus management** - Primeiro campo com erro recebe foco
- ✅ **Navegação por teclado** - Tab entre campos funciona perfeitamente

---

## Integração React Hook Form + Zod

### Schema de Validação

```tsx
import { z } from 'zod'

const formSchema = z.object({
  email: z.string().email('Email inválido'),
  password: z.string().min(8, 'Mínimo 8 caracteres'),
})

type FormData = z.infer<typeof formSchema>
```

### Configuração do Form

```tsx
import { useForm } from 'react-hook-form'
import { zodResolver } from '@hookform/resolvers/zod'

const form = useForm<FormData>({
  resolver: zodResolver(formSchema),
  defaultValues: {
    email: '',
    password: '',
  },
  mode: 'onChange', // Opcional: validar em tempo real
})
```

### Renderização do Form

```tsx
import {
  Form,
  FormControl,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
} from '@/components/ui/form'
;<Form {...form}>
  <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-4">
    <FormField
      control={form.control}
      name="email"
      render={({ field }) => (
        <FormItem>
          <FormLabel>Email</FormLabel>
          <FormControl>
            <Input type="email" {...field} />
          </FormControl>
          <FormMessage />
        </FormItem>
      )}
    />
    <Button type="submit">Enviar</Button>
  </form>
</Form>
```

---

## Exemplos de Código

### Formulário Básico

```tsx
import { useForm } from 'react-hook-form'
import { zodResolver } from '@hookform/resolvers/zod'
import { z } from 'zod'
import {
  Form,
  FormControl,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
} from '@/components/ui/form'

const formSchema = z.object({
  name: z.string().min(2),
  email: z.string().email(),
})

function MyForm() {
  const form = useForm<z.infer<typeof formSchema>>({
    resolver: zodResolver(formSchema),
  })

  function onSubmit(values: z.infer<typeof formSchema>) {
    console.log(values)
  }

  return (
    <Form {...form}>
      <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-4">
        <FormField
          control={form.control}
          name="name"
          render={({ field }) => (
            <FormItem>
              <FormLabel>Nome</FormLabel>
              <FormControl>
                <Input {...field} />
              </FormControl>
              <FormMessage />
            </FormItem>
          )}
        />

        <FormField
          control={form.control}
          name="email"
          render={({ field }) => (
            <FormItem>
              <FormLabel>Email</FormLabel>
              <FormControl>
                <Input type="email" {...field} />
              </FormControl>
              <FormMessage />
            </FormItem>
          )}
        />

        <Button type="submit">Enviar</Button>
      </form>
    </Form>
  )
}
```

### Com Texto de Ajuda

```tsx
<FormField
  control={form.control}
  name="username"
  render={({ field }) => (
    <FormItem>
      <FormLabel>Username</FormLabel>
      <FormControl>
        <Input {...field} />
      </FormControl>
      <FormDescription>Este será seu nome público.</FormDescription>
      <FormMessage />
    </FormItem>
  )}
/>
```

### Com Checkbox

```tsx
<FormField
  control={form.control}
  name="terms"
  render={({ field }) => (
    <FormItem className="flex flex-row items-start space-x-3 space-y-0">
      <FormControl>
        <Checkbox checked={field.value} onCheckedChange={field.onChange} />
      </FormControl>
      <div className="space-y-1 leading-none">
        <FormLabel>Aceito os termos</FormLabel>
        <FormMessage />
      </div>
    </FormItem>
  )}
/>
```

### Validação Customizada

```tsx
const formSchema = z
  .object({
    password: z.string().min(8),
    confirmPassword: z.string(),
  })
  .refine((data) => data.password === data.confirmPassword, {
    message: 'Senhas não coincidem',
    path: ['confirmPassword'],
  })
```

### Async Submit

```tsx
async function onSubmit(values: z.infer<typeof formSchema>) {
  try {
    const response = await fetch('/api/submit', {
      method: 'POST',
      body: JSON.stringify(values),
    })
    if (response.ok) {
      toast.success('Enviado com sucesso!')
    }
  } catch (error) {
    toast.error('Erro ao enviar')
  }
}
```

---

## Validação em Tempo Real

### Mode: onChange

```tsx
const form = useForm({
  resolver: zodResolver(formSchema),
  mode: 'onChange', // Valida ao digitar
})
```

### Mode: onBlur

```tsx
const form = useForm({
  resolver: zodResolver(formSchema),
  mode: 'onBlur', // Valida ao sair do campo
})
```

### Mode: onSubmit (padrão)

```tsx
const form = useForm({
  resolver: zodResolver(formSchema),
  mode: 'onSubmit', // Valida apenas ao submeter
})
```

---

## Regras de Validação Comuns

### String

```tsx
z.string()
  .min(3, 'Mínimo 3 caracteres')
  .max(50, 'Máximo 50 caracteres')
  .email('Email inválido')
  .url('URL inválida')
  .regex(/^[a-z]+$/, 'Apenas letras minúsculas')
```

### Number

```tsx
z.coerce
  .number()
  .min(0)
  .max(100)
  .int('Deve ser inteiro')
  .positive('Deve ser positivo')
```

### Boolean

```tsx
z.boolean().refine((val) => val === true, 'Deve aceitar')
```

### Optional

```tsx
z.string().optional()
z.string().nullable()
```

---

## Dicas e Melhores Práticas

### ✅ Sempre faça

- Use Zod para validação (type-safe)
- Defina `defaultValues` para evitar uncontrolled inputs
- Use `FormMessage` para exibir erros
- Adicione `FormDescription` para campos complexos
- Use `type="submit"` no botão principal

### ❌ Evite

- Validação apenas no backend (valide também no frontend)
- Mensagens de erro genéricas
- Formulários muito longos (divida em steps)
- Submits sem loading state

---

## Props

<Controls />

---

**Última atualização**: Janeiro 2025 **Versão**: 1.0.0
